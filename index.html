<html lang="en"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Spin the Bottle</title>
  </head>

  <body class="background light-theme">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="top-controls">
      <div class="control-group left-controls">
        <div class="bottle-selector" onclick="myMenu()">
          <span class="bottle-icon">üçæ</span>
        </div>
        <div class="players-selector" onclick="showPlayersModal()">
          <span class="players-icon">üë•</span>
        </div>
        <div class="stats-selector" onclick="showStatsModal()">
          <span class="stats-icon">üìä</span>
        </div>
      </div>
      
      <div class="control-group center-controls">
        <div class="game-title">Spin the Bottle</div>
        <div class="current-player" id="currentPlayerDisplay">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞!</div>
      </div>
      
      <div class="control-group right-controls">
        <div class="sound-toggle" onclick="toggleSound()">
          <span class="sound-icon" id="soundIcon">üîä</span>
        </div>
        <div class="theme-toggle" onclick="toggleTheme()">
          <span class="theme-icon">üåô</span>
        </div>
        <div class="fullscreen-toggle" onclick="toggleFullScreen()">
          <span class="fullscreen-icon">‚õ∂</span>
        </div>
      </div>
    </div>

    <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
    <div id="dropDownContent" class="dropdown-content" onclick="switchBottle()">
      <div class="dropdown-header">–í—ã–±–µ—Ä–∏—Ç–µ –±—É—Ç—ã–ª–∫—É</div>
      <div class="bottle-options">
        <img src="img/beer.svg" class="dropDownFlasche">
        <img src="img/whiskey.svg" class="dropDownFlasche">
        <img src="img/ghty.png" class="dropDownFlasche">
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–≥—Ä–æ–∫–æ–≤ -->
    <div id="playersModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤</h2>
          <span class="close" onclick="closePlayersModal()">&times;</span>
        </div>
        <div class="players-input-container">
          <input type="text" id="playerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞" maxlength="20">
          <button onclick="addPlayer()" class="add-player-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="players-list" id="playersList">
          <div style="text-align: center; color: var(--text-color); opacity: 0.7;">–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>
        </div>
        <div class="modal-footer">
          <button onclick="startGame()" class="start-game-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
          <button onclick="closePlayersModal()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="statsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h2>
          <span class="close" onclick="closeStatsModal()">&times;</span>
        </div>
        <div class="stats-container">
          <div class="stat-item">
            <span class="stat-label">–í—Å–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏–π:</span>
            <span class="stat-value" id="totalSpins">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π —É–≥–æ–ª:</span>
            <span class="stat-value" id="averageRotation">0¬∞</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">–õ—é–±–∏–º–∞—è –±—É—Ç—ã–ª–∫–∞:</span>
            <span class="stat-value" id="favoriteBottle">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">–°–µ–≥–æ–¥–Ω—è –≤—Ä–∞—â–µ–Ω–∏–π:</span>
            <span class="stat-value" id="todaySpins">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">–†–µ–∫–æ—Ä–¥ —É–≥–ª–∞:</span>
            <span class="stat-value" id="maxRotation">0¬∞</span>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="resetStats()" class="reset-stats-btn">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
          <button onclick="closeStatsModal()" class="cancel-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
    <div class="game-area">
      <div class="flasche flascheAnime" style="transform: rotate(3221.68deg);">
        <img onclick="turnBottle()" id="flasche" src="img/beer.svg">
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–∞—Å—Ç–∏—Ü -->
    <div id="particlesContainer"></div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <audio id="spinSound" preload="auto">
      <source src="sound/spin-sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="stopSound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="celebrationSound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

<style>
  :root {
    --bg-color: white;
    --text-color: #333;
    --dropdown-bg: white;
    --dropdown-border: #ccc;
    --control-bg: rgba(255, 255, 255, 0.95);
    --control-border: rgba(0,0,0,0.1);
    --shadow-color: rgba(0,0,0,0.1);
    --accent-color: #4a90e2;
  }

  .dark-theme {
    --bg-color: #1a1a1a;
    --text-color: #ffffff;
    --dropdown-bg: #2d2d2d;
    --dropdown-border: #444;
    --control-bg: rgba(45, 45, 45, 0.95);
    --control-border: rgba(255,255,255,0.1);
    --shadow-color: rgba(255,255,255,0.1);
    --accent-color: #64b5f6;
  }

  .light-theme {
    --bg-color: white;
    --text-color: #333;
    --dropdown-bg: white;
    --dropdown-border: #ccc;
    --control-bg: rgba(255, 255, 255, 0.95);
    --control-border: rgba(0,0,0,0.1);
    --shadow-color: rgba(0,0,0,0.1);
    --accent-color: #4a90e2;
  }

  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  .background{
    background-color: var(--bg-color);
    color: var(--text-color);
    background-repeat:no-repeat;
    background-position: center;
    display: flex;
    flex-direction: column;
    height: 100vh;
    transition: all 0.3s ease;
  }

  /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .top-controls {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: var(--control-bg);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--control-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 1000;
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .bottle-selector, .players-selector, .stats-selector {
    background: var(--accent-color);
    color: white;
    padding: 12px 20px;
    border-radius: 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    font-size: 16px;
    box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
    border: none;
    opacity: 1;
    transition: all 0.3s ease;
    min-width: 120px;
    justify-content: center;
  }

  .players-selector {
    background: #ffa502;
    box-shadow: 0 4px 15px rgba(255, 165, 2, 0.3);
  }

  .stats-selector {
    background: #8e44ad;
    box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
  }

  .bottle-selector:hover, .players-selector:hover, .stats-selector:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
  }

  .bottle-selector:active, .players-selector:active, .stats-selector:active {
    transform: translateY(0);
  }

  .bottle-icon, .players-icon, .stats-icon {
    font-size: 20px;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–≥—Ä—ã */
  .game-title {
    font-size: 24px;
    font-weight: bold;
    color: var(--text-color);
    text-shadow: 0 2px 4px var(--shadow-color);
  }

  .current-player {
    font-size: 16px;
    color: var(--accent-color);
    font-weight: 600;
    text-shadow: 0 2px 4px var(--shadow-color);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { opacity: 0.7; }
    50% { opacity: 1; }
    100% { opacity: 0.7; }
  }

  /* –ö–Ω–æ–ø–∫–∏ —Å–ø—Ä–∞–≤–∞ */
  .theme-toggle, .fullscreen-toggle, .sound-toggle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--control-bg);
    border: 2px solid var(--control-border);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 1;
    box-shadow: 0 2px 10px var(--shadow-color);
  }

  .theme-toggle:hover, .fullscreen-toggle:hover, .sound-toggle:hover {
    transform: scale(1.1);
    border-color: var(--accent-color);
  }

  .theme-icon, .fullscreen-icon, .sound-icon {
    font-size: 20px;
    transition: transform 0.3s ease;
  }

  .theme-toggle:hover .theme-icon {
    transform: rotate(180deg);
  }

  .fullscreen-toggle:hover .fullscreen-icon {
    transform: scale(1.2);
  }

  .sound-muted {
    opacity: 0.5;
  }

  /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
  .game-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 70px;
  }

  .flasche{
    display: flex;
    position: relative;
    justify-content: center;
    height: 60%;
    width: 60%;
    filter: drop-shadow(0 0 30px var(--shadow-color));
    transition: filter 0.3s ease;
  }

  @keyframes flascheKeyFrames {
      from { 
        transform: translateX(100px) rotate(0deg);
        opacity: 0;
      }
      to { 
        transform: translateX(0) rotate(0deg);
        opacity: 1;
      }
    }
  
  .flascheAnime{
    animation-name: flascheKeyFrames;
    animation-duration: 1s;
    animation-timing-function: ease-out;
  }

  /* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
  .dropdown-content {
    position: fixed;
    top: 80px;
    left: 20px;
    background: var(--dropdown-bg);
    border: 1px solid var(--dropdown-border);
    box-shadow: 0 8px 30px var(--shadow-color);
    display: none;
    z-index: 999;
    padding: 20px;
    border-radius: 20px;
    backdrop-filter: blur(20px);
    min-width: 300px;
  }

  .dropdown-content.show {
    display: block;
    animation: dropdownAppear 0.3s ease;
  }

  @keyframes dropdownAppear {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .dropdown-header {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
    color: var(--text-color);
  }

  .bottle-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
  }

  .dropDownFlasche {
    max-height: 120px;
    max-width: auto;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 10px;
    padding: 10px;
    background: var(--control-bg);
  }

  .dropDownFlasche:hover {
    transform: scale(1.15);
    background: var(--accent-color);
  }

  /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
  .modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    backdrop-filter: blur(5px);
  }

  .modal-content {
    background-color: var(--dropdown-bg);
    margin: 5% auto;
    padding: 0;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 50px rgba(0,0,0,0.3);
    border: 1px solid var(--dropdown-border);
    animation: modalAppear 0.3s ease;
  }

  @keyframes modalAppear {
    from {
      opacity: 0;
      transform: scale(0.8) translateY(-50px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--dropdown-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h2 {
    margin: 0;
    color: var(--text-color);
  }

  .close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .close:hover {
    color: var(--text-color);
  }

  .players-input-container {
    padding: 20px;
    display: flex;
    gap: 10px;
  }

  #playerInput {
    flex: 1;
    padding: 12px 15px;
    border: 2px solid var(--dropdown-border);
    border-radius: 10px;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 16px;
    transition: border-color 0.3s ease;
  }

  #playerInput:focus {
    outline: none;
    border-color: var(--accent-color);
  }

  .add-player-btn, .start-game-btn {
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .add-player-btn:hover, .start-game-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
  }

  .players-list {
    padding: 0 20px;
    max-height: 200px;
    overflow-y: auto;
  }

  .player-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin: 5px 0;
    background: var(--control-bg);
    border-radius: 10px;
    border: 1px solid var(--dropdown-border);
  }

  .player-name {
    color: var(--text-color);
    font-weight: 500;
  }

  .remove-player {
    background: #ff4757;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .remove-player:hover {
    transform: scale(1.1);
    background: #ff3742;
  }

  .modal-footer {
    padding: 20px;
    border-top: 1px solid var(--dropdown-border);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .cancel-btn {
    background: var(--control-bg);
    color: var(--text-color);
    border: 1px solid var(--dropdown-border);
    padding: 12px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .cancel-btn:hover {
    background: var(--dropdown-border);
  }

  .reset-stats-btn {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .reset-stats-btn:hover {
    background: #c0392b;
    transform: translateY(-2px);
  }

  /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
  .stats-container {
    padding: 20px;
  }

  .stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--dropdown-border);
  }

  .stat-label {
    color: var(--text-color);
    font-weight: 500;
  }

  .stat-value {
    color: var(--accent-color);
    font-weight: bold;
    font-size: 18px;
  }

  /* –ê–Ω–∏–º–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü */
  .particle {
    position: fixed;
    pointer-events: none;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    z-index: 9999;
    animation: particleFloat 1.5s ease-out forwards;
  }

  @keyframes particleFloat {
    0% {
      transform: translate(0, 0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translate(var(--tx), var(--ty)) scale(0);
      opacity: 0;
    }
  }

  .particle.emoji {
    width: 24px;
    height: 24px;
    font-size: 20px;
    text-align: center;
    line-height: 24px;
    background: none !important;
  }

  .celebration-effect {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: bold;
    color: gold;
    text-shadow: 0 0 20px rgba(255,215,0,0.8);
    z-index: 10000;
    animation: celebrationPop 2s ease-out forwards;
    pointer-events: none;
  }

  @keyframes celebrationPop {
    0% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0;
    }
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
  @media (max-width: 768px) {
    .top-controls {
      height: 60px;
      padding: 0 15px;
    }
    
    .bottle-selector, .players-selector, .stats-selector {
      padding: 10px 15px;
      min-width: 100px;
      font-size: 14px;
    }
    
    .game-title {
      font-size: 20px;
    }
    
    .theme-toggle, .fullscreen-toggle, .sound-toggle {
      width: 45px;
      height: 45px;
    }
    
    .dropdown-content {
      min-width: 250px;
      left: 15px;
      top: 70px;
    }

    .players-input-container {
      flex-direction: column;
    }
    
    .modal-footer {
      flex-direction: column;
    }
  }

  /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
  .theme-transition * {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
  }
</style>

<script type="text/javascript" charset="utf-8">
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    var spinning = 0;
    var stopSpinning = 0;
    var players = [];
    var currentPlayerIndex = 0;
    var soundEnabled = true;
    var currentBottle = 'beer';

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    const stats = JSON.parse(localStorage.getItem('bottleStats')) || {
        totalSpins: 0,
        averageRotation: 0,
        favoriteBottle: 'beer',
        maxRotation: 0,
        bottleUsage: { beer: 0, whiskey: 0, ghty: 0 },
        dailySpins: {},
        lastPlayDate: null
    };

    // –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
    const spinSound = document.getElementById('spinSound');
    const stopSound = document.getElementById('stopSound');
    const clickSound = document.getElementById('clickSound');
    const celebrationSound = document.getElementById('celebrationSound');

    // –§—É–Ω–∫—Ü–∏–∏ –∑–≤—É–∫–æ–≤
    function playSpinSound() {
        if (soundEnabled) {
            spinSound.currentTime = 0;
            spinSound.play().catch(e => console.log("Audio play error:", e));
        }
    }

    function playStopSound() {
        if (soundEnabled) {
            stopSound.currentTime = 0;
            stopSound.play().catch(e => console.log("Audio play error:", e));
        }
    }

    function playClickSound() {
        if (soundEnabled) {
            clickSound.currentTime = 0;
            clickSound.play().catch(e => console.log("Audio play error:", e));
        }
    }

    function toggleSound() {
        soundEnabled = !soundEnabled;
        const soundIcon = document.getElementById('soundIcon');
        if (soundEnabled) {
            soundIcon.textContent = 'üîä';
            soundIcon.parentElement.classList.remove('sound-muted');
            playClickSound();
        } else {
            soundIcon.textContent = 'üîá';
            soundIcon.parentElement.classList.add('sound-muted');
        }
    }

    // –§—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats(rotation, bottleType) {
        const today = new Date().toDateString();
        
        stats.totalSpins++;
        stats.averageRotation = (stats.averageRotation * (stats.totalSpins - 1) + rotation) / stats.totalSpins;
        
        if (rotation > stats.maxRotation) {
            stats.maxRotation = rotation;
        }
        
        if (stats.bottleUsage[bottleType] !== undefined) {
            stats.bottleUsage[bottleType]++;
        }
        
        let maxUsage = 0;
        let favorite = 'beer';
        for (const bottle in stats.bottleUsage) {
            if (stats.bottleUsage[bottle] > maxUsage) {
                maxUsage = stats.bottleUsage[bottle];
                favorite = bottle;
            }
        }
        stats.favoriteBottle = favorite;
        
        if (!stats.dailySpins[today]) {
            stats.dailySpins[today] = 0;
        }
        stats.dailySpins[today]++;
        stats.lastPlayDate = today;
        
        localStorage.setItem('bottleStats', JSON.stringify(stats));
        checkAchievements(rotation);
    }

    function getTodaySpins() {
        const today = new Date().toDateString();
        return stats.dailySpins[today] || 0;
    }

    function renderStats() {
        document.getElementById('totalSpins').textContent = stats.totalSpins;
        document.getElementById('averageRotation').textContent = Math.round(stats.averageRotation) + '¬∞';
        document.getElementById('favoriteBottle').textContent = getBottleName(stats.favoriteBottle);
        document.getElementById('todaySpins').textContent = getTodaySpins();
        document.getElementById('maxRotation').textContent = Math.round(stats.maxRotation) + '¬∞';
    }

    function getBottleName(bottleType) {
        const names = {
            'beer': '–ü–∏–≤–æ',
            'whiskey': '–í–∏—Å–∫–∏', 
            'ghty': '–û—Å–æ–±–∞—è'
        };
        return names[bottleType] || bottleType;
    }

    function resetStats() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
            localStorage.removeItem('bottleStats');
            Object.assign(stats, {
                totalSpins: 0,
                averageRotation: 0,
                favoriteBottle: 'beer',
                maxRotation: 0,
                bottleUsage: { beer: 0, whiskey: 0, ghty: 0 },
                dailySpins: {},
                lastPlayDate: null
            });
            renderStats();
            playClickSound();
        }
    }

    function checkAchievements(rotation) {
        if (stats.totalSpins === 10) {
            showCelebration('üéâ 10 –≤—Ä–∞—â–µ–Ω–∏–π!');
        } else if (stats.totalSpins === 50) {
            showCelebration('üèÜ 50 –≤—Ä–∞—â–µ–Ω–∏–π!');
        } else if (stats.totalSpins === 100) {
            showCelebration('üëë 100 –≤—Ä–∞—â–µ–Ω–∏–π!');
        }
        
        if (rotation > 3000 && rotation > stats.maxRotation) {
            showCelebration('‚ö° –†–µ–∫–æ—Ä–¥ —É–≥–ª–∞!');
        }
        
        if (getTodaySpins() === 10) {
            showCelebration('üî• 10 –∑–∞ –¥–µ–Ω—å!');
        }
    }

    function showCelebration(text) {
        if (soundEnabled) {
            celebrationSound.currentTime = 0;
            celebrationSound.play().catch(e => console.log("Celebration sound error:", e));
        }
        
        const celebration = document.createElement('div');
        celebration.className = 'celebration-effect';
        celebration.textContent = text;
        document.body.appendChild(celebration);
        
        createParticles(30, true);
        
        setTimeout(() => {
            celebration.remove();
        }, 2000);
    }

    // –§—É–Ω–∫—Ü–∏–∏ —á–∞—Å—Ç–∏—Ü
    function createParticles(count = 20, isCelebration = false) {
        const container = document.getElementById('particlesContainer');
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        const emojis = ['üéâ', '‚ú®', '‚≠ê', 'üåü', 'üí´', 'üî•', 'üí•', 'üéä'];
        
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            
            if (isCelebration && Math.random() > 0.5) {
                particle.className = 'particle emoji';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.fontSize = (Math.random() * 16 + 12) + 'px';
            } else {
                particle.className = 'particle';
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
            }
            
            const angle = Math.random() * Math.PI * 2;
            const distance = 100 + Math.random() * 200;
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;
            
            particle.style.left = centerX + 'px';
            particle.style.top = centerY + 'px';
            
            particle.style.setProperty('--tx', tx + 'px');
            particle.style.setProperty('--ty', ty + 'px');
            
            particle.style.animationDelay = (Math.random() * 0.5) + 's';
            particle.style.animationDuration = (0.8 + Math.random() * 0.7) + 's';
            
            container.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.remove();
                }
            }, 2000);
        }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏
    function showPlayersModal() {
        playClickSound();
        document.getElementById('playersModal').style.display = 'block';
        loadPlayers();
        document.getElementById('playerInput').focus();
    }

    function closePlayersModal() {
        playClickSound();
        document.getElementById('playersModal').style.display = 'none';
    }

    function addPlayer() {
        const input = document.getElementById('playerInput');
        const name = input.value.trim();
        
        if (name && players.length < 12) {
            players.push(name);
            input.value = '';
            savePlayers();
            renderPlayersList();
            playClickSound();
        } else if (players.length >= 12) {
            alert('–ú–∞–∫—Å–∏–º—É–º 12 –∏–≥—Ä–æ–∫–æ–≤!');
        }
    }

    function removePlayer(index) {
        playClickSound();
        players.splice(index, 1);
        savePlayers();
        renderPlayersList();
    }

    function renderPlayersList() {
        const list = document.getElementById('playersList');
        list.innerHTML = '';
        
        players.forEach((player, index) => {
            const playerItem = document.createElement('div');
            playerItem.className = 'player-item';
            playerItem.innerHTML = `
                <span class="player-name">${player}</span>
                <button class="remove-player" onclick="removePlayer(${index})">√ó</button>
            `;
            list.appendChild(playerItem);
        });
        
        if (players.length === 0) {
            list.innerHTML = '<div style="text-align: center; color: var(--text-color); opacity: 0.7;">–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>';
        }
    }

    function savePlayers() {
        localStorage.setItem('bottlePlayers', JSON.stringify(players));
    }

    function loadPlayers() {
        const saved = localStorage.getItem('bottlePlayers');
        if (saved) {
            players = JSON.parse(saved);
            renderPlayersList();
        }
    }

    function startGame() {
        if (players.length < 2) {
            alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 2 –∏–≥—Ä–æ–∫–æ–≤!');
            return;
        }
        
        playClickSound();
        closePlayersModal();
        currentPlayerIndex = 0;
        updateCurrentPlayerDisplay();
        
        document.getElementById('currentPlayerDisplay').textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ö—Ä—É—Ç–∏—Ç–µ –±—É—Ç—ã–ª–∫—É!';
        setTimeout(() => {
            updateCurrentPlayerDisplay();
        }, 2000);
    }

    function updateCurrentPlayerDisplay() {
        const display = document.getElementById('currentPlayerDisplay');
        if (players.length > 0) {
            display.textContent = `–°–µ–π—á–∞—Å: ${players[currentPlayerIndex]}`;
        } else {
            display.textContent = '–ù–∞–∂–º–∏—Ç–µ "–ò–≥—Ä–æ–∫–∏" –¥–ª—è –Ω–∞—á–∞–ª–∞';
        }
    }

    function getNextPlayer() {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        return players[currentPlayerIndex];
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function showStatsModal() {
        playClickSound();
        renderStats();
        document.getElementById('statsModal').style.display = 'block';
    }

    function closeStatsModal() {
        playClickSound();
        document.getElementById('statsModal').style.display = 'none';
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('playerInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            addPlayer();
        }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
    window.onclick = function(event) {
        const playersModal = document.getElementById('playersModal');
        const statsModal = document.getElementById('statsModal');
        
        if (event.target === playersModal) {
            closePlayersModal();
        }
        if (event.target === statsModal) {
            closeStatsModal();
        }
        
        if (!event.target.closest('.bottle-selector') && 
            !event.target.closest('.dropdown-content') &&
            !event.target.closest('.theme-toggle') &&
            !event.target.closest('.fullscreen-toggle') &&
            !event.target.closest('.players-selector') &&
            !event.target.closest('.stats-selector')) {
            
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getSavedTheme() {
        return localStorage.getItem('theme') || 'light-theme';
    }

    function saveTheme(theme) {
        localStorage.setItem('theme', theme);
    }

    function applyTheme(theme) {
        document.body.className = 'background ' + theme;
        updateThemeIcon(theme);
    }

    function updateThemeIcon(theme) {
        const themeIcon = document.querySelector('.theme-icon');
        themeIcon.textContent = theme === 'dark-theme' ? '‚òÄÔ∏è' : 'üåô';
    }

    function toggleTheme() {
        playClickSound();
        const currentTheme = document.body.classList.contains('dark-theme') ? 'dark-theme' : 'light-theme';
        const newTheme = currentTheme === 'dark-theme' ? 'light-theme' : 'dark-theme';
        
        document.body.classList.add('theme-transition');
        applyTheme(newTheme);
        saveTheme(newTheme);
        
        setTimeout(() => {
            document.body.classList.remove('theme-transition');
        }, 300);
        
        if(spinning > 0){
            stopSpinning = 1;
        }
    }

    function toggleFullScreen() {
        playClickSound();
        var doc = window.document;
        var docEl = doc.documentElement;

        var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

        if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
            requestFullScreen.call(docEl);
        } else {
            cancelFullScreen.call(doc);
        }
    }

    function delay(time) {
        return new Promise(resolve => setTimeout(resolve, time));
    }

    async function turnBottle(){
        if (players.length < 2) {
            alert('–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ —á–µ—Ä–µ–∑ –º–µ–Ω—é "–ò–≥—Ä–æ–∫–∏"!');
            return;
        }
        
        playClickSound();
        playSpinSound();
        createParticles(15);
        
        spinning ++;
        if ( typeof turnBottle.winkelPre == 'undefined' ){
          turnBottle.winkelPre = 0;
        } else {
          turnBottle.winkelPre = turnBottle.winkel;
        }
        
        turnBottle.winkel = Math.random() * 3600 + 1800;
        let winkelStepped = turnBottle.winkel;

        let i = 1;
        let loops = 500;
        while (winkelStepped <= turnBottle.winkel || i<loops && spinning==1) {
          let winkelNextStr = winkelStepped.toString() + 'deg';
          document.getElementsByClassName("flasche")[0].style.cssText =  'transform: rotate('+winkelNextStr+');';
          winkelStepped = winkelStepped + (loops-i)/i;
          i++;
          await delay(10);
          if(stopSpinning==1){
            stopSpinning=0;
            break;
          }
        }
        
        playStopSound();
        createParticles(25);
        
        updateStats(turnBottle.winkel, currentBottle);
        
        stopSpinning = 0;
        spinning--;
        
        const selectedPlayer = getNextPlayer();
        document.getElementById('currentPlayerDisplay').textContent = `–í—ã–±—Ä–∞–Ω: ${selectedPlayer}!`;
    }

    function myMenu() {
        playClickSound();
        document.getElementById("dropDownContent").classList.toggle("show");
    }

    function play() {
        document.querySelector(".flasche").style.cssText =  'transform: rotate(0deg);';
        document.querySelector(".flasche").className = "flasche";
        window.requestAnimationFrame(function(time) {
            window.requestAnimationFrame(function(time) {
                document.querySelector(".flasche").className = "flasche flascheAnime";
            });
        });
    }

    function switchBottle() {
        playClickSound();
        if(spinning>0){
            stopSpinning = 1;
        }
        if (event.target.matches('.dropDownFlasche')) {
            const element = document.getElementById('flasche')
            element.src=event.target.src;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –±—É—Ç—ã–ª–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            if (event.target.src.includes('beer')) currentBottle = 'beer';
            else if (event.target.src.includes('whiskey')) currentBottle = 'whiskey';
            else if (event.target.src.includes('ghty')) currentBottle = 'ghty';
            
            play();
        }
        document.getElementById("dropDownContent").classList.remove("show");
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', function() {
        const savedTheme = getSavedTheme();
        applyTheme(savedTheme);
        loadPlayers();
        updateCurrentPlayerDisplay();
        
        setTimeout(function() { 
            window.scrollTo(0, 1); 
        }, 1);
    }, false);
</script>
</body></html>
